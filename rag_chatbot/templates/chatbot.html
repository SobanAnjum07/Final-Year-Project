
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>{% block title %}{% endblock %}</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">

    <style>
        
          * {
              margin: 0;
              padding: 0;
              box-sizing: border-box;
              font-family: monospace;
          }

          body {
              background: #000;
              color: white !important;
              display: flex;
              justify-content: center;
              align-items: center;
              height: 100vh;
              overflow: hidden;
          }

          

          .chatbot-container {
            
              width: 50%;
              height: 80vh;
              background: rgba(0, 0, 0, 0.9);
              border: 2px solid cyan;
              border-radius: 15px;
              display: flex;
              flex-direction: column;
              overflow: auto;
              box-shadow: 0px 0px 20px cyan;
          }


          .chat-header {
              background: cyan;
              color: black;
              text-align: center;
              padding: 15px;
              font-size: 20px;
              font-weight: bold;
          }

          .chatbot-container::-webkit-scrollbar,
        .chat-messages::-webkit-scrollbar {
            width: 0px;
          }
          

          .chat-messages {
              flex: 1;
              padding: 10px;
              display: flex;
              flex-direction: column;
              gap: 10px;

          }

          .bot-message {
              align-self: flex-start;
              max-width: 75%;
              background: rgba(0, 255, 255, 0.1);
              padding: 10px;
              border: 1px solid cyan;
              border-radius: 10px 10px 10px 0;
              animation: fadeIn 0.5s ease-in-out;
          }


          .user-message {
              align-self: flex-end;
              max-width: 75%;
              background: cyan;
              color: black;
              padding: 10px;
              border: 1px solid cyan;
              border-radius: 10px 10px 0 10px;
              animation: fadeIn 0.5s ease-in-out;
          }


          .chat-input {
              display: flex;
              align-items: center;
              padding: 10px;
              background: rgba(0, 0, 0, 0.8);
              border-top: 1px solid cyan;
          }

          .chat-input input {
              flex: 1;
              padding: 10px;
              border: 1px solid cyan;
              background: #111;
              color: white;
              border-radius: 5px;
              outline: none;
              margin-right: 10px;
          }

          .chat-input input::placeholder {
              color: #ffffffa0;
          }

          .chat-input button {
              padding: 10px 15px;
              background: cyan;
              color: black;
              border: none;
              border-radius: 5px;
              font-weight: bold;
              cursor: pointer;
              transition: background 0.3s;
          }

          .chat-input button:hover{
            background: cyan;
            color: greenyellow;
            transition: background 0.5s;
          }
          
          .chat-input input:focus {
            color:#ffffffa0;
            background-color: #111111;
            outline: cyan;
            box-shadow: none !important;
          }

          .card{
            background-color: #000;
          }
          b{
            color: cyan;
          }
          hr {
              border: 1px solid aqua !important; /* Set the border color */
              border-radius: 10px !important;     /* Round the corners */
              background-color: aqua !important;  /* Optional: Set the background color if needed */
          }

          @keyframes fadeIn {
              from {
                  opacity: 0;
                  transform: translateY(10px);
              }
              to {
                  opacity: 1;
                  transform: translateY(0);
              }
          }

          @keyframes slideInFromRight {
                0% {
                  transform: translateX(100%); /* Start from the right off-screen */
                }
                100% {
                  transform: translateX(0); /* Move to the original position */
                }
              }

              .chatbot-container {
                animation: slideInFromRight 1s ease-in-out forwards;
              }

          @media (max-width: 768px) {
            .chatbot-container {
                width: 90%; /* Adjust the width for smaller screens */
                height: 80vh; /* Adjust the height if needed */
            }
        }

        @media (max-width: 480px) {
            .chatbot-container {
                width: 100%; /* Full width on very small screens */
                height: 100vh; /* Adjust the height further */
            }
        }

      </style>
    </head>

    <body>
        <div class="chatbot-container">
          <div class="card flex-grow-1">
            <div class="chat-header">
              <h1>DataVerse AI Chatbot</h1>
            </div>
            
            <div class="card-body messages-box">
              
              <ul class="list-unstyled messages-list">
                
                <li class="message received">
                  <div class="message-text">
                    <div class="message-sender">
                      <b>AI Chatbot</b>
                    </div>
                    <div class="message-content">
                      Hi {{user.username}}, I am your AI Chatbot, you can ask me anything.
                      <hr>
                    </div>
                  </div>
                </li>

                {% for chat in chats %}
                  {% if chat.user == request.user %}

                    <li class="message sent">
                  <div class="message-text">
                    <div class="message-sender">
                      <b>You</b>
                    </div>
                    <div class="message-content">
                      {{chat.message}}
                      <hr>

                    </div>
                  </div>
                </li>

                <li class="message received">
                  <div class="message-text">
                    <div class="message-sender">
                      <b>AI Chatbot</b>
                    </div>
                    <div class="message-content">
                      {{chat.response}}
                      <hr>

                    </div>
                  </div>
                </li>

                  {% endif %}
                {% endfor %}
                
              </ul>
              
            </div>
            <br><br>
            <br><br>
            <br><br>
          </div>
          <form class="message-form">
            {%csrf_token%}
            <div class="input-group chat-input">
              <input type="text" class="form-control message-input " placeholder="Type your message...">
              <div class="input-group-append ">
                <button type="submit" class="btn btn-primary btn-send">Send</button>
              </div>
            </div>
          </form>
        </div>
        <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
    </body>

    <script>
      const messagesList = document.querySelector('.messages-list');
      const messageForm = document.querySelector('.message-form');
      const messageInput = document.querySelector('.message-input');

      messageForm.addEventListener('submit', (event) => {
        event.preventDefault();

        const message = messageInput.value.trim();
        if (message.length === 0) {
          return;
        }

        const messageItem = document.createElement('li');
        messageItem.classList.add('message', 'sent');
        messageItem.innerHTML = `
            <div class="message-text">
                <div class="message-sender">
                    <b>You</b>
                </div>
                <div class="message-content">
                    ${message}
                    <hr>
                </div>
            </div>`;
        messagesList.appendChild(messageItem);

        messageInput.value = '';

        fetch('', {
          method: 'POST',
          headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
          body: new URLSearchParams({
            'csrfmiddlewaretoken': document.querySelector('[name=csrfmiddlewaretoken]').value,
            'message': message
          })
        })
        .then(response => response.json())  // Ensure the response is treated as JSON
        .then(data => {
          const response = data.response;
          const messageItem = document.createElement('li');
          messageItem.classList.add('message', 'received');
          messageItem.innerHTML = `
            <div class="message-text">
              <div class="message-sender">
                <b>AI Chatbot</b>
              </div>
              <div class="message-content">
                ${response}
                <hr>
              </div>
            </div>
          `;
          messagesList.appendChild(messageItem);
        })
        .catch(error => {
          console.error("Error:", error);
        });

      });

    </script>
</html>

